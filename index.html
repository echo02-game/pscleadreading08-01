<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ™®é€šè©±æ°´å¹³æ¸¬è©¦æœ—è®€ä½œå“8è™Ÿ</title>
    <style>
        /* --- åŸºç¤æ¨£å¼èˆ‡å­—é«” --- */
        @font-face {
            font-family: 'StandardPinyin';
            src: local('Calibri'), local('Arial');
        }
        
        :root {
            --primary-color: #4a90e2;
            --text-color: #333;
            --pinyin-color: #666;
            --star-inactive: #e0e0e0;
            --star-active: #ffd700;
            --bg-color: #f9f9f9;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            /* å­—é«”æ£§ï¼šMacä½¿ç”¨åœ“é«”ï¼ŒWindowsä½¿ç”¨å¹¼åœ“ï¼Œå¾Œå‚™å¾®è»Ÿé›…é»‘ */
            font-family: "Yuanti SC", "YouYuan", "Microsoft YaHei", "Rounded Mplus 1c", sans-serif;
            -webkit-font-smoothing: antialiased;
            padding-bottom: 180px; /* å¢åŠ åº•éƒ¨ç•™ç™½ï¼Œç¢ºä¿å…§å®¹ä¸è¢«çå‹µæ¬„é®æ“‹ */
            color: var(--text-color);
        }

        /* --- é ‚éƒ¨æ¨™é¡Œæ¬„ --- */
        .header {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            background: rgba(255,255,255,0.98);
            padding: 10px 15px;
            text-align: right;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            z-index: 100;
            box-sizing: border-box;
            backdrop-filter: blur(5px);
        }

        .page-title {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--text-color);
            margin: 0 0 5px 0;
        }

        .disclaimer {
            font-size: 0.75rem;
            color: gray;
            line-height: 1.3;
        }

        /* --- ä¸»å…§å®¹å€ --- */
        .container {
            max-width: 800px;
            margin: 110px auto 0;
            padding: 20px;
        }

        .sentence-item {
            background: #fff;
            margin-bottom: 20px;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.03);
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            transition: transform 0.2s;
        }

        .pinyin {
            font-family: 'StandardPinyin', sans-serif;
            font-size: 1.15rem;
            color: var(--pinyin-color);
            margin-bottom: 8px;
            line-height: 1.4;
            word-wrap: break-word;
        }

        .chinese-text {
            font-size: 1.4rem;
            color: var(--text-color);
            line-height: 1.6;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .controls {
            align-self: flex-end;
            width: 100%;
            text-align: right;
        }

        .play-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 10px 24px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-family: inherit;
            box-shadow: 0 4px 6px rgba(74, 144, 226, 0.2);
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }

        .play-btn:active {
            transform: scale(0.96);
        }

        .play-btn.playing {
            background: #ff6b6b;
            box-shadow: 0 4px 6px rgba(255, 107, 107, 0.2);
        }

        /* --- åº•éƒ¨çå‹µæ¬„ --- */
        .reward-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            height: 90px;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.08);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 200;
            padding: 0 5%;
            box-sizing: border-box;
        }

        .track-container {
            width: 100%;
            max-width: 600px;
            position: relative;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .track-line {
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 6px;
            background: #f0f0f0;
            z-index: 1;
            transform: translateY(-50%);
            border-radius: 3px;
        }

        /* æ˜Ÿæ˜Ÿæ¨£å¼ */
        .star-node {
            font-size: 24px;
            color: var(--star-inactive);
            z-index: 2;
            position: relative;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            line-height: 1;
            background: white;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .star-node.active {
            color: var(--star-active);
            transform: scale(1.3);
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
        }

        .trophy {
            font-size: 32px;
            color: var(--star-inactive);
            z-index: 2;
            position: relative;
            transition: all 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            margin-left: 10px;
            background: white;
        }

        .trophy.active {
            color: #f39c12;
            filter: drop-shadow(0 0 8px rgba(243, 156, 18, 0.6));
            transform: scale(1.4) rotate(-15deg);
        }

        /* --- å®ŒæˆæŒ‰éˆ•å€åŸŸ --- */
        .completion-area {
            text-align: center;
            margin: 40px 0 20px;
            opacity: 0.3;
            pointer-events: none;
            filter: grayscale(1);
            transition: all 0.5s ease;
        }

        .completion-area.unlocked {
            opacity: 1;
            pointer-events: auto;
            filter: grayscale(0);
        }

        .finish-btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 16px 40px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(0, 242, 254, 0.3);
            font-weight: bold;
            font-family: inherit;
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        .finish-btn:active {
            transform: scale(0.98);
        }

        .home-link {
            margin-top: 25px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            color: #666;
            text-decoration: none;
            font-size: 1rem;
            padding: 10px 20px;
            border-radius: 20px;
            background: #f0f0f0;
            opacity: 1 !important; 
            pointer-events: auto !important;
            filter: grayscale(0) !important;
        }

        /* --- ç™»éŒ„å½ˆçª— --- */
        #login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,1);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .login-box {
            background: white;
            padding: 40px 30px;
            border-radius: 24px;
            text-align: center;
            width: 85%;
            max-width: 340px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
        }

        .login-input {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid #eee;
            border-radius: 12px;
            font-size: 1rem;
            box-sizing: border-box;
            font-family: inherit;
            outline: none;
            transition: border-color 0.3s;
            -webkit-appearance: none;
        }

        .login-input:focus {
            border-color: var(--primary-color);
        }

        /* --- é–‹ç™¼è€…æ¨¡å¼ --- */
        #dev-trigger {
            position: fixed;
            top: 15px;
            left: 15px;
            font-size: 24px;
            color: #ddd;
            cursor: pointer;
            z-index: 1000;
            display: none;
            opacity: 0.5;
        }
        
        #dev-trigger:hover { opacity: 1; }
        
        #dev-panel {
            position: fixed;
            bottom: 120px;
            left: 20px;
            background: rgba(30,30,30,0.95);
            color: #0f0;
            padding: 20px;
            border-radius: 12px;
            z-index: 2000;
            display: none;
            width: 320px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            font-family: monospace;
        }

        #dev-panel button {
            margin: 5px 2px;
            padding: 8px 12px;
            cursor: pointer;
            background: #444;
            color: white;
            border: 1px solid #666;
            border-radius: 4px;
        }

        /* --- æˆåŠŸå½ˆçª— --- */
        .custom-alert {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background: white;
            padding: 30px;
            border-radius: 24px;
            box-shadow: 0 20px 80px rgba(0,0,0,0.3);
            z-index: 3000;
            text-align: center;
            display: none;
            width: 80%;
            max-width: 300px;
            opacity: 0;
            transition: all 0.3s;
        }
        
        .custom-alert.show {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
        }
        
        .custom-alert h3 { margin-top: 0; color: var(--primary-color); font-size: 1.5rem; }
        .close-alert {
            margin-top: 20px;
            background: #f0f0f0;
            border: none;
            padding: 12px 40px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            color: #555;
            font-weight: bold;
        }

        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2999;
            display: none;
            backdrop-filter: blur(2px);
        }
    </style>
</head>
<body>

    <!-- ç™»éŒ„å±¤ -->
    <div id="login-overlay">
        <div class="login-box">
            <h2 style="color: var(--primary-color); margin-bottom: 20px;">é–‹å§‹ç·´ç¿’</h2>
            <form id="login-form" onsubmit="event.preventDefault(); attemptLogin();">
                <input type="text" id="username" class="login-input" placeholder="è«‹è¼¸å…¥æ‚¨çš„åå­—" autocomplete="off" required>
                <input type="password" id="password" class="login-input" placeholder="è«‹è¼¸å…¥å¯†ç¢¼" required>
                <button type="submit" class="finish-btn" style="width:100%; margin-top:20px; font-size:1.1rem; padding: 12px;">é€²å…¥</button>
            </form>
            <p id="login-msg" style="color: #ff4757; font-size: 0.9rem; height: 1.5em; margin-top: 15px;"></p>
        </div>
    </div>

    <!-- é ‚éƒ¨æ¨™é¡Œ -->
    <header class="header">
        <div class="page-title">æ™®é€šè©±æ°´å¹³æ¸¬è©¦æœ—è®€ä½œå“8è™Ÿ</div>
        <div class="disclaimer">
            æœ¬ç¶²é æ‹¼éŸ³å‡ç”±AIç”Ÿæˆï¼Œæ¨™æº–æ³¨éŸ³è«‹åƒè€ƒã€Šæ™®é€šè©±æ°´å¹³æ¸¬è©¦å¯¦æ–½ç¶±è¦ï¼ˆ2021å¹´ç‰ˆï¼‰ã€‹ã€‚<br>
            éŒ„éŸ³åƒ…ä¾›åƒè€ƒã€‚ç¶²é åƒ…ä¾›VTCå†…éƒ¨ä½¿ç”¨ã€‚è·æ¥­è¨“ç·´å±€æ™®é€šè©±åŸ¹è¨“æ¸¬è©¦ä¸­å¿ƒç‰ˆæ¬Šæ‰€æœ‰ã€‚
        </div>
    </header>

    <!-- é–‹ç™¼è€…æŒ‰éˆ• -->
    <div id="dev-trigger" onclick="toggleDevMode()" title="é–‹ç™¼è€…æ¨¡å¼">ğŸ› ï¸</div>

    <!-- é–‹ç™¼è€…é¢æ¿ -->
    <div id="dev-panel">
        <h3 style="margin-top:0; border-bottom:1px solid #555; padding-bottom:10px;">æ™‚é–“è»¸éŒ„è£½å·¥å…·</h3>
        <p>ç‹€æ…‹: <span id="dev-status" style="color:#fff;">å°±ç·’</span></p>
        <p>æ™‚é–“: <span id="dev-time" style="font-size:1.5rem; color:#0ff;">0.00</span> s</p>
        <div style="display:flex; flex-wrap:wrap; gap:5px;">
            <button onclick="startRecording()" style="background:#2ecc71;">â–¶ é–‹å§‹éŒ„è£½</button>
            <button onclick="markNext()" style="background:#e67e22; flex-grow:1;">ğŸš© æ¨™è¨˜ä¸‹ä¸€å¥ (Space)</button>
            <button onclick="exportData()" style="background:#3498db;">ğŸ“‹ è¤‡è£½ JSON</button>
        </div>
        <div style="font-size: 0.75rem; margin-top:15px; color:#aaa; line-height:1.4;">
            æ­¥é©Ÿï¼š1.é»æ“Šé–‹å§‹ 2.æ¯è½åˆ°å¥æœ«ç«‹å³æŒ‰æ¨™è¨˜(æˆ–ç©ºæ ¼) 3.å…¨éƒ¨æ’­å®Œå¾Œè¤‡è£½ä»£ç¢¼ 4.æ›¿æ›æºæ–‡ä»¶ sentenceData
        </div>
    </div>

    <!-- ä¸»å…§å®¹ -->
    <div class="container" id="content-area"></div>

    <!-- å®Œæˆå€åŸŸ -->
    <div class="completion-area" id="completion-area">
        <button class="finish-btn" id="final-btn" onclick="finishPractice()">æˆ‘å·²å®Œæˆè·Ÿè®€ç·´ç¿’å•¦ï¼</button>
        <br>
        <a href="https://echo02-game.github.io/pscleadreading-hub/" class="home-link">
            <span>ğŸ“–</span> å›ä¸»ç›®éŒ„
        </a>
    </div>

    <!-- åº•éƒ¨çå‹µè»Œé“ -->
    <div class="reward-bar">
        <div class="track-container" id="track-container">
            <div class="track-line"></div>
        </div>
    </div>

    <!-- æˆåŠŸå½ˆçª— -->
    <div class="modal-backdrop" id="modal-backdrop"></div>
    <div class="custom-alert" id="success-alert">
        <div style="font-size: 3rem; margin-bottom: 10px;">ğŸ‰</div>
        <h3>å¤ªæ£’å•¦ï¼</h3>
        <p style="color:#666; line-height:1.5;">æ‰“å¡ä¿¡æ¯å·²è¤‡è£½ï¼Œå¿«å»åˆ†äº«åŠªåŠ›å¾Œçš„å–œæ‚…å§ï¼</p>
        <button class="close-alert" onclick="closeAlert()">é—œé–‰</button>
    </div>

    <!-- éŸ³é »æº (ä½œå“8è™Ÿ) -->
    <audio id="main-audio" src="pscleadreading08.mp3" preload="auto" playsinline></audio>

<script>
    // --- æ ¸å¿ƒæ•¸æ“š (ä½œå“8è™Ÿæ•¸æ“š) ---
    // æ™‚é–“è»¸æ•¸æ“šç›®å‰åˆå§‹åŒ–ç‚º 0ï¼Œè«‹åœ¨Windowsé›»è…¦ä¸Šä½¿ç”¨é–‹ç™¼è€…æ¨¡å¼éŒ„è£½ä¸¦æ›¿æ›
    let sentenceData = [
    {
        "text": "å¾è‚‡æ…¶å¸‚é©…è»ŠåŠå°æ™‚å·¦å³ï¼Œä¾¿åˆ°äº†æ±éƒŠé¢¨æ™¯åå‹é¼æ¹–å±±ã€‚",
        "pinyin": "CÃ³ng ZhÃ oqÃ¬ngshÃ¬ qÅ«chÄ“ bÃ n xiÇoshÃ­ zuÇ’yÃ²u, biÃ n dÃ ole dÅngjiÄo fÄ“ngjÇng mÃ­ngshÃ¨ng DÇnghÃºshÄn.",
        "start": 0,
        "end": 8.92
    },
    {
        "text": "ä¸‹äº†å¹¾å¤©çš„å°é›¨å‰›åœï¼Œæ»¿å±±ç± ç½©ç€è¼•ç´—ä¼¼çš„è–„éœ§ã€‚",
        "pinyin": "XiÃ le jÇ tiÄn de xiÇoyÇ” gÄng tÃ­ng, mÇnshÄn lÃ³ngzhÃ ozhe qÄ«ngshÄ shÃ¬ de bÃ³wÃ¹.",
        "start": 8.92,
        "end": 16.81
    },
    {
        "text": "éäº†å¯’ç¿ æ©‹ï¼Œå°±è½åˆ°æ·™æ·™çš„æ³‰è²ã€‚",
        "pinyin": "GuÃ²le HÃ¡ncuÃ¬qiÃ¡o, jiÃ¹ tÄ«ngdÃ o cÃ³ngcÃ³ng de quÃ¡nshÄ“ng.",
        "start": 16.81,
        "end": 22.1
    },
    {
        "text": "é€²å±±ä¸€çœ‹ï¼Œè‰å¢çŸ³ç¸«ï¼Œåˆ°è™•éƒ½æ¹§æµç€æ¸…äº®çš„æ³‰æ°´ã€‚",
        "pinyin": "JÃ¬nshÄn yÄ« kÃ n, cÇocÃ³ng shÃ­fÃ¨ng, dÃ ochÃ¹ dÅu yÇ’ngliÃºzhe qÄ«ngliÃ ng de quÃ¡nshuÇ.",
        "start": 22.1,
        "end": 30.7
    },
    {
        "text": "è‰è±æ—èŒ‚ï¼Œä¸€è·¯ä¸Šæ³‰æ°´æ™‚éš±æ™‚ç¾ï¼Œæ³‰è²ä¸çµ•æ–¼è€³ã€‚",
        "pinyin": "CÇofÄ“ng-lÃ­nmÃ o, yÄ«lÃ¹shÃ ng quÃ¡nshuÇ shÃ­yÇn-shÃ­xiÃ n, quÃ¡nshÄ“ng bÃ¹juÃ©yÃº'Ä›r.",
        "start": 30.7,
        "end": 39.85
    },
    {
        "text": "æœ‰æ™‚å¹¾è‚¡æ³‰æ°´äº¤éŒ¯æµç€‰ï¼Œé®æ–·è·¯é¢ï¼Œæˆ‘å€‘å¾—å°‹æ‰¾ç€å¢Šè…³çš„çŸ³å¡Šè·³èºç€å‰é€²ã€‚",
        "pinyin": "YÇ’ushÃ­ jÇ gÇ” quÃ¡nshuÇ jiÄocuÃ² liÃºxiÃ¨, zhÄ“duÃ n lÃ¹miÃ n, wÇ’men dÄ›i xÃºnzhÇozhe diÃ njiÇo de shÃ­kuÃ i tiÃ oyuÃ¨zhe qiÃ¡njÃ¬n.",
        "start": 39.85,
        "end": 52.11
    },
    {
        "text": "æ„ˆå¾€ä¸Šèµ°æ¨¹æ„ˆå¯†ï¼Œç¶ é™°æ„ˆæ¿ƒã€‚",
        "pinyin": "YÃ¹ wÇng shÃ ng zÇ’u shÃ¹ yÃ¹ mÃ¬, lÇœyÄ«n yÃ¹ nÃ³ng.",
        "start": 52.11,
        "end": 58.51
    },
    {
        "text": "æ¿•æ¼‰æ¼‰çš„ç¶ è‘‰ï¼ŒçŒ¶å¦‚å¤§æµ·çš„æ³¢æµªï¼Œä¸€å±¤ä¸€å±¤æ¹§å‘å±±é ‚ã€‚",
        "pinyin": "ShÄ«lÃ¹lÃ¹ de lÇœyÃ¨, yÃ³urÃº dÃ hÇi de bÅlÃ ng, yÄ«cÃ©ng yÄ«cÃ©ng yÇ’ngxiÃ ng shÄndÇng.",
        "start": 58.51,
        "end": 67.17
    },
    {
        "text": "æ³‰æ°´éš±åˆ°äº†æ¿ƒé™°çš„æ·±è™•ï¼Œè€Œæ³‰è²å»æ›´åŠ æ¸…ç´”æ‚…è€³ã€‚",
        "pinyin": "QuÃ¡nshuÇ yÇndÃ ole nÃ³ngyÄ«n de shÄ“nchÃ¹, Ã©r quÃ¡nshÄ“ng quÃ¨ gÃ¨ngjiÄ qÄ«ngchÃºn yuÃ¨'Ä›r.",
        "start": 67.17,
        "end": 76.4
    },
    {
        "text": "å¿½ç„¶ï¼Œé›²ä¸­å‚³ä¾†é˜è²ï¼Œé “æ™‚å±±é³´è°·æ‡‰ï¼Œæ‚ æ‚ æšæšã€‚",
        "pinyin": "HÅ«rÃ¡n, yÃºnzhÅng chuÃ¡nlÃ¡i zhÅngshÄ“ng, dÃ¹nshÃ­ shÄnmÃ­ng-gÇ”yÃ¬ng, yÅuyÅu-yÃ¡ngyÃ¡ng.",
        "start": 76.4,
        "end": 85.33
    },
    {
        "text": "å®‰è©³åšé‡çš„é˜è²å’Œæ­¡å¿«æ´»æ½‘çš„æ³‰è²ï¼Œåœ¨é›¨å¾Œå¯§éœçš„æš®è‰²ä¸­ï¼ŒåŒ¯æˆä¸€ç‰‡ç¾å¦™çš„éŸ³éŸ¿ã€‚",
        "pinyin": "Ä€nxiÃ¡ng hÃ²uzhÃ²ng de zhÅngshÄ“ng hÃ© huÄnkuÃ i huÃ³pÅ de quÃ¡nshÄ“ng, zÃ i yÇ”hÃ²u nÃ­ngjÃ¬ng de mÃ¹sÃ¨ zhÅng, huÃ¬chÃ©ng yÄ«piÃ n mÄ›imiÃ o de yÄ«nxiÇng.",
        "start": 85.33,
        "end": 98.06
    },
    {
        "text": "æˆ‘å€‘å¾ªç€é˜è²ï¼Œä¾†åˆ°äº†åŠå±±è…°çš„æ…¶é›²å¯ºã€‚",
        "pinyin": "WÇ’men xÃºnzhe zhÅngshÄ“ng, lÃ¡idÃ ole bÃ nshÄnyÄo de QÃ¬ngyÃºnsÃ¬.",
        "start": 98.06,
        "end": 104.16
    },
    {
        "text": "é€™æ˜¯ä¸€åº§å»ºæ–¼æ˜ä»£ã€è¦æ¨¡å®å¤§çš„å¶ºå—è‘—åå¤å‰ã€‚",
        "pinyin": "ZhÃ¨ shÃ¬ yÄ« zuÃ² jiÃ nyÃº MÃ­ngdÃ i, guÄ«mÃ³ hÃ³ngdÃ  de LÇngnÃ¡n zhÃ¹mÃ­ng gÇ”chÃ .",
        "start": 104.16,
        "end": 111.94
    },
    {
        "text": "åº­é™¢è£ç¹èŠ±ä¼¼éŒ¦ï¼Œå¤æ¨¹åƒå¤©ã€‚",
        "pinyin": "TÃ­ngyuÃ n lÇ fÃ¡nhuÄ-sÃ¬jÇn, gÇ”shÃ¹-cÄntiÄn.",
        "start": 111.94,
        "end": 117.73
    },
    {
        "text": "æœ‰ä¸€æ ªèˆ‡å¤å‰åŒé½¡çš„èŒ¶èŠ±ï¼Œé‚„æœ‰å…©æ ªå¾æ–¯é‡Œè˜­å¡å¼•ç¨®çš„ã€æœ‰äºŒç™¾å¤šå¹´æ¨¹é½¡çš„è©ææ¨¹ã€‚",
        "pinyin": "YÇ’u yÄ« zhÅ« yÇ” gÇ”chÃ  tÃ³nglÃ­ng de chÃ¡huÄ, hÃ¡iyÇ’u liÇng zhÅ« cÃ³ng SÄ«lÇlÃ¡nkÇ yÇnzhÇ’ng de, yÇ’u Ã¨rbÇi duÅ niÃ¡n shÃ¹lÃ­ng de pÃºtÃ­shÃ¹.",
        "start": 117.73,
        "end": 130.33
    },
    {
        "text": "æˆ‘å€‘æ±ºå®šå°±åœ¨é€™åº§å¯ºé™¢è£å€Ÿå®¿ã€‚",
        "pinyin": "WÇ’men juÃ©dÃ¬ng jiÃ¹ zÃ i zhÃ¨ zuÃ² sÃ¬yuÃ n lÇ jiÃ¨sÃ¹.",
        "start": 130.33,
        "end": 135.04
    },
    {
        "text": "å…¥å¤œï¼Œå±±ä¸­è¬ç±Ÿä¿±å¯‚ï¼Œè¡¹æœ‰æ³‰è²ä¸€ç›´å‚³é€åˆ°æ•é‚Šã€‚",
        "pinyin": "RÃ¹yÃ¨, shÄnzhÅng wÃ nlÃ i-jÃ¹jÃ¬, zhÇyÇ’u quÃ¡nshÄ“ng yÄ«zhÃ­ chuÃ¡nsÃ²ng dÃ o zhÄ›nbiÄn.",
        "start": 135.04,
        "end": 145.48
    },
    {
        "text": "ä¸€è·¯ä¸Šè½åˆ°çš„å„ç¨®æ³‰è²ï¼Œé€™æ™‚å€™èººåœ¨åºŠä¸Šï¼Œå¯ä»¥ç”¨å¿ƒç´°ç´°åœ°è†è½ã€è¾¨è­˜ã€å“å‘³ã€‚",
        "pinyin": "YÄ«lÃ¹shÃ ng tÄ«ngdÃ o de gÃ¨zhÇ’ng quÃ¡nshÄ“ng, zhÃ¨ shÃ­hou tÇng zÃ i chuÃ¡ngshÃ ng, kÄ›yÇ yÃ²ngxÄ«n xÃ¬xÃ¬ de lÃ­ngtÄ«ng, biÃ nshÃ­, pÇnwÃ¨i.",
        "start": 145.48,
        "end": 158.76
    },
    {
        "text": "é‚£åƒå°æç´ä¸€æ¨£è¼•æŸ”çš„ï¼Œæ˜¯è‰å¢ä¸­æµæ·Œçš„å°æºªçš„è²éŸ³ï¼›",
        "pinyin": "NÃ  xiÃ ng xiÇotÃ­qÃ­n yÄ«yÃ ng qÄ«ngrÃ³u de, shÃ¬ cÇocÃ³ng zhÅng liÃºtÇng de xiÇoxÄ« de shÄ“ngyÄ«n;",
        "start": 158.76,
        "end": 166.86
    },
    {
        "text": "é‚£åƒçµç¶ä¸€æ¨£æ¸…è„†çš„ï¼Œ//æ˜¯åœ¨çŸ³ç¸«é–“è·Œè½çš„æ¾—æ°´çš„è²éŸ³ï¼›",
        "pinyin": "NÃ  xiÃ ng pÃ­pÃ¡ yÄ«yÃ ng qÄ«ngcuÃ¬ de, //shÃ¬ zÃ i shÃ­fÃ¨ng jiÄn diÄ“luÃ² de jiÃ nshuÇ de shÄ“ngyÄ«n;",
        "start": 166.86,
        "end": 174.52
    },
    {
        "text": "é‚£åƒå¤§æç´ä¸€æ¨£åšé‡å›éŸ¿çš„ï¼Œæ˜¯ç„¡æ•¸é“ç´°æµåŒ¯èšæ–¼ç©ºè°·çš„è²éŸ³ï¼›",
        "pinyin": "NÃ  xiÃ ng dÃ tÃ­qÃ­n yÄ«yÃ ng hÃ²uzhÃ²ng huÃ­xiÇng de, shÃ¬ wÃºshÃ¹ dÃ o xÃ¬liÃº huÃ¬jÃ¹ yÃº kÅnggÇ” de shÄ“ngyÄ«n;",
        "start": 174.52,
        "end": 184.13
    },
    {
        "text": "é‚£åƒéŠ…ç®¡é½Šé³´ä¸€æ¨£é›„æ¸¾ç£…ç¤´çš„ï¼Œæ˜¯é£›ç€‘æ€¥æµè·Œå…¥æ·±æ½­çš„è²éŸ³ã€‚",
        "pinyin": "NÃ  xiÃ ng tÃ³ngguÇn qÃ­mÃ­ng yÄ«yÃ ng xiÃ³nghÃºn pÃ¡ngbÃ³ de, shÃ¬ fÄ“ipÃ¹ jÃ­liÃº diÄ“rÃ¹ shÄ“ntÃ¡n de shÄ“ngyÄ«n.",
        "start": 184.13,
        "end": 194.26
    }
];

    // --- å…¨å±€è®Šé‡ ---
    let currentUser = "";
    let audio = document.getElementById('main-audio');
    let currentSentenceIndex = -1;
    let isPlaying = false;
    let completedSentences = new Array(sentenceData.length).fill(false);
    let checkTimer = null;

    // --- 1. ç™»éŒ„èˆ‡åˆå§‹åŒ– ---
    function attemptLogin() {
        const nameInput = document.getElementById('username');
        const passInput = document.getElementById('password');
        const msg = document.getElementById('login-msg');

        const nameVal = nameInput.value.trim();
        const passVal = passInput.value.trim();

        if (!nameVal) {
            msg.textContent = "è«‹è¼¸å…¥åå­—";
            nameInput.focus();
            return;
        }

        if (passVal === 'vtcpsc') {
            currentUser = nameVal;
            document.getElementById('login-overlay').style.display = 'none';
            // iOSéœ€è¦ç”¨æˆ¶äº¤äº’è§¸ç™¼éŸ³é »åŠ è¼‰
            audio.load();
            initApp();
        } else {
            msg.textContent = "è«‹è¼¸å…¥æ­£ç¢ºå¯†ç¢¼";
            passInput.value = '';
            passInput.focus();
            passInput.style.borderColor = "#ff4757";
            setTimeout(() => passInput.style.borderColor = "#eee", 500);
        }
    }

    function initApp() {
        const container = document.getElementById('content-area');
        const track = document.getElementById('track-container');

        sentenceData.forEach((item, index) => {
            // å‰µå»ºå¥å­å€å¡Š
            const div = document.createElement('div');
            div.className = 'sentence-item';
            div.id = `sent-${index}`;
            div.innerHTML = `
                <div class="pinyin">${item.pinyin}</div>
                <div class="chinese-text">${item.text}</div>
                <div class="controls">
                    <button class="play-btn" id="btn-${index}" onclick="toggleSentence(${index})">
                        <span>â–¶</span> æ’­æ”¾
                    </button>
                </div>
            `;
            container.appendChild(div);

            // å‰µå»ºé€²åº¦æ˜Ÿæ˜Ÿ
            const star = document.createElement('div');
            star.className = 'star-node';
            star.id = `star-${index}`;
            star.innerText = 'â˜…'; 
            track.appendChild(star);
        });

        // æ·»åŠ çµ‚é»çæ¯
        const trophy = document.createElement('div');
        trophy.className = 'trophy';
        trophy.id = 'trophy';
        trophy.innerHTML = 'ğŸ†';
        track.appendChild(trophy);

        // æª¢æŸ¥Windowsç’°å¢ƒé¡¯ç¤ºé–‹ç™¼è€…å…¥å£
        if (navigator.userAgent.indexOf("Windows") !== -1) {
            document.getElementById('dev-trigger').style.display = 'block';
        }
    }

    // --- 2. æ’­æ”¾é‚è¼¯ ---
    let sentenceEndState = false;

    function toggleSentence(index) {
        const data = sentenceData[index];
        const btn = document.getElementById(`btn-${index}`);

        if (currentSentenceIndex !== index) {
            if (currentSentenceIndex !== -1) {
                resetBtnUI(currentSentenceIndex); 
            }
            currentSentenceIndex = index;
            sentenceEndState = false;
            startPlayback(index, data.start);
        } 
        else {
            if (sentenceEndState) {
                sentenceEndState = false;
                startPlayback(index, data.start);
            } else if (isPlaying) {
                audio.pause();
                isPlaying = false;
                updateBtnUI(index, false);
                stopTimer();
            } else {
                audio.play().catch(e => console.error("Play error:", e));
                isPlaying = true;
                updateBtnUI(index, true);
                startTimer(index);
            }
        }
    }

    function startPlayback(index, startTime) {
        // é–‹ç™¼è€…æ¨¡å¼æœªéŒ„è£½æ•¸æ“šæ™‚ï¼Œå…è¨±æ’­æ”¾
        audio.currentTime = startTime;
        const playPromise = audio.play();
        
        if (playPromise !== undefined) {
            playPromise.then(() => {
                isPlaying = true;
                updateBtnUI(index, true);
                startTimer(index);
            }).catch(error => {
                console.error("Playback failed:", error);
                alert("æ’­æ”¾å¤±æ•—ï¼Œè«‹æª¢æŸ¥éŸ³é »æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚");
            });
        }
    }

    function startTimer(index) {
        if (checkTimer) clearInterval(checkTimer);
        checkTimer = setInterval(() => {
            const data = sentenceData[index];
            const now = audio.currentTime;

            if (devModeActive) {
                document.getElementById('dev-time').innerText = now.toFixed(2);
            } else {
                // å¦‚æœå·²è¨­ç½®äº†çµæŸæ™‚é–“ (end > 0)ï¼Œå‰‡åœ¨åˆ°é”æ™‚æš«åœ
                if (data.end > 0 && now >= data.end) {
                    audio.pause();
                    isPlaying = false;
                    sentenceEndState = true;
                    stopTimer();
                    updateBtnUI(index, false); 
                    markCompleted(index);
                }
            }
        }, 30);
    }

    function stopTimer() {
        if (checkTimer) clearInterval(checkTimer);
        checkTimer = null;
    }

    function updateBtnUI(index, isPlaying) {
        const btn = document.getElementById(`btn-${index}`);
        if (!btn) return;
        
        if (isPlaying) {
            btn.classList.add('playing');
            btn.innerHTML = '<span>âšâš</span> æš«åœ';
        } else {
            btn.classList.remove('playing');
            btn.innerHTML = '<span>â–¶</span> æ’­æ”¾';
        }
    }

    function resetBtnUI(index) {
        updateBtnUI(index, false);
        audio.pause();
    }

    // --- 3. çå‹µç³»çµ± ---
    function markCompleted(index) {
        if (!completedSentences[index]) {
            completedSentences[index] = true;
            document.getElementById(`star-${index}`).classList.add('active');
            
            if (completedSentences.every(Boolean)) {
                setTimeout(() => {
                    document.getElementById('trophy').classList.add('active');
                    document.getElementById('completion-area').classList.add('unlocked');
                    window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
                }, 500);
            }
        }
    }

    // --- 4. å®Œæˆèˆ‡åˆ†äº« ---
    function finishPractice() {
        const today = new Date();
        const dateStr = `${today.getMonth() + 1}æœˆ${today.getDate()}æ—¥`;
        const text = `${currentUser}å·²æ–¼${dateStr}å®Œæˆä½œå“8è™Ÿè·Ÿè®€ç·´ç¿’ï¼`;

        if (navigator.clipboard && window.isSecureContext) {
            navigator.clipboard.writeText(text).then(showSuccess).catch(legacyCopy);
        } else {
            legacyCopy(text);
        }

        function legacyCopy(val) {
            const ta = document.createElement('textarea');
            ta.value = val || text;
            ta.style.position = 'fixed';
            document.body.appendChild(ta);
            ta.focus();
            ta.select();
            try {
                document.execCommand('copy');
                showSuccess();
            } catch (err) {
                alert("è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•æˆªåœ–åˆ†äº«");
            }
            document.body.removeChild(ta);
        }
    }

    function showSuccess() {
        document.getElementById('modal-backdrop').style.display = 'block';
        const alertBox = document.getElementById('success-alert');
        alertBox.style.display = 'block';
        setTimeout(() => alertBox.classList.add('show'), 10);
    }

    function closeAlert() {
        const alertBox = document.getElementById('success-alert');
        alertBox.classList.remove('show');
        setTimeout(() => {
            alertBox.style.display = 'none';
            document.getElementById('modal-backdrop').style.display = 'none';
        }, 300);
    }

    // --- 5. é–‹ç™¼è€…æ¨¡å¼ (Dev Mode) ---
    let devModeActive = false;
    let devSentences = [];
    let devCurrentIndex = 0;

    function toggleDevMode() {
        devModeActive = !devModeActive;
        const panel = document.getElementById('dev-panel');
        panel.style.display = devModeActive ? 'block' : 'none';
        
        if (devModeActive) {
            // å¼·åˆ¶é¡¯ç¤ºåŸç”Ÿæ’­æ”¾å™¨ä»¥ä¾¿èª¿è©¦æ‹–å‹•ï¼Œä¸”ç½®æ–¼é»‘è‰²é¢æ¿ä¸Šæ–¹
            audio.controls = true; 
            audio.style.position = "fixed";
            audio.style.bottom = "200px"; 
            audio.style.left = "20px";
            audio.style.width = "calc(100% - 40px)";
            audio.style.zIndex = "2500";
            audio.style.display = "block";
            audio.style.background = "#f1f3f4";
            audio.style.borderRadius = "30px";
            document.getElementById('dev-status').innerText = "å·²é–‹å•Ÿã€‚è«‹é»æ“Šé–‹å§‹éŒ„è£½ã€‚";
        } else {
            audio.controls = false;
            audio.style.display = "none";
        }
    }

    function startRecording() {
        devSentences = [];
        devCurrentIndex = 0;
        audio.currentTime = 0;
        
        audio.play().then(() => {
            document.getElementById('dev-status').innerText = "éŒ„è£½ä¸­... ç­‰å¾…æ¨™è¨˜ç¬¬ 1 å¥";
            document.addEventListener('keydown', handleSpaceKey);
            if (!checkTimer) startTimer(0);
        });
    }

    function handleSpaceKey(e) {
        if (e.code === 'Space') {
            e.preventDefault();
            markNext();
        }
    }

    function markNext() {
        if (!devModeActive || devCurrentIndex >= sentenceData.length) return;
        
        const now = audio.currentTime;
        let start = 0;
        
        if (devSentences.length > 0) {
            start = devSentences[devSentences.length - 1].end;
        }

        const original = sentenceData[devCurrentIndex];
        
        devSentences.push({
            text: original.text,
            pinyin: original.pinyin,
            start: parseFloat(start.toFixed(2)),
            end: parseFloat(now.toFixed(2))
        });

        devCurrentIndex++;
        
        if (devCurrentIndex < sentenceData.length) {
            document.getElementById('dev-status').innerText = `å·²æ¨™è¨˜ ${devCurrentIndex} å¥ã€‚æ­£åœ¨è½ç¬¬ ${devCurrentIndex + 1}...`;
            // é«˜äº®ç•¶å‰è¡Œ
            document.querySelectorAll('.sentence-item').forEach(el => el.style.background = '#fff');
            const currEl = document.getElementById(`sent-${devCurrentIndex}`);
            if(currEl) {
                currEl.style.background = '#e1f5fe';
                currEl.scrollIntoView({behavior: "smooth", block: "center"});
            }
        } else {
            document.getElementById('dev-status').innerText = "âœ… å®Œæˆï¼è«‹é»æ“Š [è¤‡è£½ JSON]";
            audio.pause();
            document.removeEventListener('keydown', handleSpaceKey);
        }
    }

    function exportData() {
        if (devSentences.length === 0) {
            alert("å°šæœªéŒ„è£½æ•¸æ“šï¼");
            return;
        }
        const json = JSON.stringify(devSentences, null, 4);
        navigator.clipboard.writeText(json).then(() => {
            alert("JSON å·²è¤‡è£½ï¼è«‹æ›¿æ›ä»£ç¢¼ä¸­çš„ sentenceData è®Šé‡ã€‚");
        });
    }
</script>
</body>
</html>
