<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ™®é€šè©±æ°´å¹³æ¸¬è©¦æœ—è®€ä½œå“8è™Ÿ</title>
    <style>
        /* å­—é«”è¨­ç½® */
        @font-face {
            font-family: 'RoundedChinese';
            src: local('Yuanti SC'), local('YouYuan'), local('Microsoft YaHei'), sans-serif;
        }
        
        body {
            font-family: 'RoundedChinese', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
            color: #333;
            padding-bottom: 80px; /* ç‚ºåº•éƒ¨çå‹µæ¬„ç•™ç©ºé–“ */
        }

        /* æ¨™é¡Œæ¬„ (å³ä¸Šè§’) */
        .header-title {
            position: fixed;
            top: 10px;
            right: 15px;
            text-align: right;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            padding: 5px 10px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .header-title h1 {
            font-size: 16px;
            margin: 0;
            color: #000;
        }
        .header-title p {
            font-size: 10px;
            color: gray;
            margin: 2px 0 0 0;
            max-width: 200px;
            line-height: 1.2;
        }

        /* ç™»éŒ„é é¢ */
        #login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        #login-box {
            text-align: center;
            padding: 20px;
            width: 80%;
            max-width: 300px;
        }
        #login-box h2 { margin-bottom: 20px; }
        .input-group { margin-bottom: 15px; }
        input {
            padding: 10px;
            width: 100%;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 16px;
        }
        button.login-btn {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
        }
        .error-msg { color: red; font-size: 14px; margin-top: 10px; display: none; }

        /* ä¸»å…§å®¹å€ */
        .container {
            max-width: 800px;
            margin: 80px auto 20px auto; /* Top margin for header */
            padding: 20px;
        }

        /* å¥å­è¡Œæ¨£å¼ */
        .sentence-row {
            margin-bottom: 25px;
            padding: 15px;
            border-radius: 10px;
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: background-color 0.3s;
        }
        .sentence-row.played {
            background-color: #fffde7; /* æ·ºé»ƒè‰² */
        }
        .pinyin {
            font-family: 'Calibri', sans-serif;
            font-size: 18px;
            color: #666;
            margin-bottom: 5px;
            line-height: 1.5;
        }
        .hanzi {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 10px;
            line-height: 1.6;
        }
        .controls {
            display: flex;
            gap: 10px;
        }
        .control-btn {
            background: #e0e0e0;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .control-btn:active { background: #d0d0d0; }

        /* å®ŒæˆæŒ‰éˆ• */
        #finish-section {
            text-align: center;
            margin-top: 40px;
            padding-bottom: 60px;
        }
        #finish-btn {
            background-color: #4CAF50;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 30px;
            font-size: 18px;
            cursor: pointer;
            opacity: 0.5;
            pointer-events: none;
        }
        #finish-btn.active {
            opacity: 1;
            pointer-events: auto;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }

        /* åº•éƒ¨çå‹µè»Œé“ */
        .gamification-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 60px;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            padding: 0 20px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            overflow-x: auto;
            z-index: 900;
        }
        .track {
            display: flex;
            align-items: center;
            gap: 5px;
            margin: 0 auto;
            min-width: max-content;
        }
        .star {
            font-size: 20px;
            color: #ccc; /* ç©ºå¿ƒç°è‰²æ•ˆæœ */
            transition: all 0.5s;
        }
        .star.active {
            color: #FFD700;
            text-shadow: 0 0 5px #FFD700;
            transform: scale(1.2);
        }
        .trophy {
            font-size: 24px;
            color: #ccc;
            margin-left: 10px;
        }
        .trophy.active {
            color: #FFD700;
            text-shadow: 0 0 10px orange;
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* å½ˆçª— */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 3000;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 80%;
            position: relative;
        }
        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #aaa;
        }
        .home-link {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
            text-decoration: none;
            color: #333;
            font-weight: bold;
            padding: 10px 20px;
            background: #f0f0f0;
            border-radius: 8px;
        }

        /* é–‹ç™¼è€…æ¨¡å¼æŒ‰éˆ• */
        #dev-toggle {
            position: fixed;
            top: 10px;
            left: 10px;
            font-size: 20px;
            color: #ccc;
            cursor: pointer;
            z-index: 1001;
            opacity: 0.5;
        }
        
        /* é–‹ç™¼è€…é¢æ¿ */
        #dev-panel {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 300px;
            background: black;
            color: #0f0;
            z-index: 5000;
            padding: 20px;
            box-sizing: border-box;
            overflow-y: auto;
            font-family: monospace;
        }
        #dev-panel button {
            background: #333;
            color: white;
            border: 1px solid #666;
            padding: 5px 10px;
            margin-right: 10px;
            cursor: pointer;
        }
        #dev-output {
            width: 100%;
            height: 150px;
            background: #222;
            color: #0f0;
            border: none;
            margin-top: 10px;
        }
        /* Devæ¨¡å¼ä¸‹å¼·åˆ¶é¡¯ç¤ºæ’­æ”¾å™¨ */
        body.dev-mode audio {
            display: block !important;
            position: fixed;
            bottom: 310px;
            left: 0;
            width: 100%;
            z-index: 5001;
        }
    </style>
</head>
<body>

    <!-- æ¨™é¡Œ -->
    <div class="header-title">
        <h1>æ™®é€šè©±æ°´å¹³æ¸¬è©¦æœ—è®€ä½œå“8è™Ÿ</h1>
        <p>æœ¬ç¶²é æ‹¼éŸ³å‡ç”±AIç”Ÿæˆï¼Œæ¨™æº–æ³¨éŸ³è«‹åƒè€ƒã€Šæ™®é€šè©±æ°´å¹³æ¸¬è©¦å¯¦æ–½ç¶±è¦ï¼ˆ2021å¹´ç‰ˆï¼‰ã€‹ã€‚éŒ„éŸ³åƒ…ä¾›åƒè€ƒã€‚ç¶²é åƒ…ä¾›VTCå†…éƒ¨ä½¿ç”¨ã€‚è·æ¥­è¨“ç·´å±€æ™®é€šè©±åŸ¹è¨“æ¸¬è©¦ä¸­å¿ƒç‰ˆæ¬Šæ‰€æœ‰ã€‚</p>
    </div>

    <!-- é–‹ç™¼è€…æ¨¡å¼é–‹é—œ -->
    <div id="dev-toggle" onclick="toggleDevMode()">ğŸ› ï¸</div>

    <!-- ç™»éŒ„é®ç½© -->
    <div id="login-overlay">
        <div id="login-box">
            <h1>é–‹å§‹ç·´ç¿’</h1>
            <div class="input-group">
                <input type="text" id="username" placeholder="è¼¸å…¥ä½ çš„åå­—" />
            </div>
            <div class="input-group">
                <input type="password" id="password" placeholder="è¼¸å…¥å¯†ç¢¼" onkeypress="handleEnter(event)" />
            </div>
            <button class="login-btn" onclick="checkLogin()">é€²å…¥</button>
            <p class="error-msg" id="login-error">è«‹è¼¸å…¥æ­£ç¢ºå¯†ç¢¼</p>
        </div>
    </div>

    <!-- ä¸»å…§å®¹ -->
    <div class="container" id="main-content">
        <!-- å¥å­å°‡ç”± JS ç”Ÿæˆ -->
    </div>

    <!-- å®ŒæˆæŒ‰éˆ• -->
    <div id="finish-section">
        <button id="finish-btn" onclick="showCompletion()">æˆ‘å·²å®Œæˆè·Ÿè®€ç·´ç¿’å•¦ï¼</button>
    </div>

    <!-- çå‹µè»Œé“ -->
    <div class="gamification-bar">
        <div class="track" id="star-track">
            <!-- æ˜Ÿæ˜Ÿå°‡ç”± JS ç”Ÿæˆ -->
        </div>
    </div>

    <!-- å½ˆçª— -->
    <div id="completion-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <h2>å¤ªæ£’å•¦ï¼</h2>
            <p>æ‰“å¡ä¿¡æ¯å·²è¤‡è£½ï¼Œå¿«å»åˆ†äº«åŠªåŠ›å¾Œçš„å–œæ‚…å§ï¼</p>
            <div id="home-link-container" style="display:none;">
                <a href="https://echo02-game.github.io/pscleadreading-hub/" class="home-link">
                    <span>ğŸ“–</span> å›ä¸»ç›®éŒ„
                </a>
            </div>
        </div>
    </div>

    <!-- éŸ³é »å…ƒç´  -->
    <audio id="audio-player" src="pscleadreading08.mp3"></audio>

    <!-- é–‹ç™¼è€…é¢æ¿ -->
    <div id="dev-panel">
        <h3>Developer Timeline Tool</h3>
        <p>Instructions: Click "Start Record", then press [SPACE] at the end of each sentence.</p>
        <button onclick="startRecording()">Start Record</button>
        <button onclick="markNext()">Mark Next (Space)</button>
        <button onclick="exportJSON()">Export JSON</button>
        <div id="current-sentence-idx">Current: 0</div>
        <textarea id="dev-output" placeholder="JSON will appear here..."></textarea>
    </div>

    <script>
        // ---------------- æ•¸æ“šå®šç¾© ----------------
        // æ³¨æ„ï¼šé€™è£¡çš„æ™‚é–“è»¸ (start/end) æ˜¯é è¨­å€¼ã€‚è«‹ä½¿ç”¨é–‹ç™¼è€…æ¨¡å¼ç”Ÿæˆæº–ç¢ºçš„ JSON æ›¿æ›æ­¤è™•ã€‚
        let sentenceData = [
    {
        "text": "å¾è‚‡æ…¶å¸‚é©…è»ŠåŠå°æ™‚å·¦å³ï¼Œä¾¿åˆ°äº†æ±éƒŠé¢¨æ™¯åå‹é¼æ¹–å±±ã€‚",
        "pinyin": "CÃ³ng ZhÃ oqÃ¬ng shÃ¬ qÅ«chÄ“ bÃ n xiÇoshÃ­ zuÇ’yÃ²u, biÃ n dÃ o le dÅngjiÄo fÄ“ngjÇng mÃ­ngshÃ¨ng DÇnghÃºshÄn.",
        "start": 0,
        "end": 9.1
    },
    {
        "text": "ä¸‹äº†å¹¾å¤©çš„å°é›¨å‰›åœï¼Œæ»¿å±±ç± ç½©ç€è¼•ç´—ä¼¼çš„è–„éœ§ã€‚",
        "pinyin": "XiÃ  le jÇ tiÄn de xiÇoyÇ” gÄng tÃ­ng, mÇnshÄn lÇ’ngzhÃ o zhe qÄ«ngshÄ shÃ¬ de bÃ³wÃ¹.",
        "start": 9.1,
        "end": 17.07
    },
    {
        "text": "éäº†å¯’ç¿ æ©‹ï¼Œå°±è½åˆ°æ·™æ·™çš„æ³‰è²ã€‚",
        "pinyin": "GuÃ² le HÃ¡ncuÃ¬qiÃ¡o, jiÃ¹ tÄ«ngdÃ o cÃ³ngcÃ³ng de quÃ¡nshÄ“ng.",
        "start": 17.07,
        "end": 22.31
    },
    {
        "text": "é€²å±±ä¸€çœ‹ï¼Œè‰å¢çŸ³ç¸«ï¼Œåˆ°è™•éƒ½æ¹§æµç€æ¸…äº®çš„æ³‰æ°´ã€‚",
        "pinyin": "JÃ¬nshÄn yÃ­ kÃ n, cÇocÃ³ng shÃ­fÃ¨ng, dÃ ochÃ¹ dÅu yÇ’ngliÃº zhe qÄ«ngliÃ ng de quÃ¡nshuÇ.",
        "start": 22.31,
        "end": 30.88
    },
    {
        "text": "è‰è±æ—èŒ‚ï¼Œä¸€è·¯ä¸Šæ³‰æ°´æ™‚éš±æ™‚ç¾ï¼Œæ³‰è²ä¸çµ•æ–¼è€³ã€‚",
        "pinyin": "CÇo fÄ“ng lÃ­n mÃ o, yÃ­ lÃ¹ shang quÃ¡nshuÇ shÃ­ yÇn shÃ­ xiÃ n, quÃ¡nshÄ“ng bÃ¹ juÃ© yÃº Ä›r.",
        "start": 30.88,
        "end": 39.93
    },
    {
        "text": "æœ‰æ™‚å¹¾è‚¡æ³‰æ°´äº¤éŒ¯æµç€‰ï¼Œé®æ–·è·¯é¢ï¼Œæˆ‘å€‘å¾—å°‹æ‰¾ç€å¢Šè…³çš„çŸ³å¡Šè·³èºç€å‰é€²ã€‚",
        "pinyin": "YÇ’ushÃ­ jÇ gÇ” quÃ¡nshuÇ jiÄocuÃ² liÃºxiÃ¨, zhÄ“duÃ n lÃ¹miÃ n, wÇ’men dÄ›i xÃºnzhÇo zhe diÃ njiÇo de shÃ­kuÃ i tiÃ oyuÃ¨ zhe qiÃ¡njÃ¬n.",
        "start": 39.93,
        "end": 52.47
    },
    {
        "text": "æ„ˆå¾€ä¸Šèµ°æ¨¹æ„ˆå¯†ï¼Œç¶ é™°æ„ˆæ¿ƒã€‚",
        "pinyin": "YÃ¹ wÇng shÃ ng zÇ’u shÃ¹ yÃ¹ mÃ¬, lÇœyÄ«n yÃ¹ nÃ³ng.",
        "start": 52.47,
        "end": 58.72
    },
    {
        "text": "æ¿•æ¼‰æ¼‰çš„ç¶ è‘‰ï¼ŒçŒ¶å¦‚å¤§æµ·çš„æ³¢æµªï¼Œä¸€å±¤ä¸€å±¤æ¹§å‘å±±é ‚ã€‚",
        "pinyin": "ShÄ«lÃ¹lÃ¹ de lÇœyÃ¨, yÃ³urÃº dÃ hÇi de bÅlÃ ng, yÃ¬ cÃ©ng yÃ¬ cÃ©ng yÇ’ng xiÃ ng shÄndÇng.",
        "start": 58.72,
        "end": 67.32
    },
    {
        "text": "æ³‰æ°´éš±åˆ°äº†æ¿ƒé™°çš„æ·±è™•ï¼Œè€Œæ³‰è²å»æ›´åŠ æ¸…ç´”æ‚…è€³ã€‚",
        "pinyin": "QuÃ¡nshuÇ yÇn dÃ o le nÃ³ngyÄ«n de shÄ“nchÃ¹, Ã©r quÃ¡nshÄ“ng quÃ¨ gÃ¨ngjiÄ qÄ«ngchÃºn yuÃ¨'Ä›r.",
        "start": 67.32,
        "end": 76.62
    },
    {
        "text": "å¿½ç„¶ï¼Œé›²ä¸­å‚³ä¾†é˜è²ï¼Œé “æ™‚å±±é³´è°·æ‡‰ï¼Œæ‚ æ‚ æšæšã€‚",
        "pinyin": "HÅ«rÃ¡n, yÃºn zhÅng chuÃ¡nlÃ¡i zhÅngshÄ“ng, dÃ¹nshÃ­ shÄn mÃ­ng gÇ” yÃ¬ng, yÅuyÅu yÃ¡ngyÃ¡ng.",
        "start": 76.62,
        "end": 85.63
    },
    {
        "text": "å®‰è©³åšé‡çš„é˜è²å’Œæ­¡å¿«æ´»æ½‘çš„æ³‰è²ï¼Œåœ¨é›¨å¾Œå¯§éœçš„æš®è‰²ä¸­ï¼ŒåŒ¯æˆä¸€ç‰‡ç¾å¦™çš„éŸ³éŸ¿ã€‚",
        "pinyin": "Ä€nxiÃ¡ng hÃ²uzhÃ²ng de zhÅngshÄ“ng hÃ© huÄnkuÃ i huÃ³pÅ de quÃ¡nshÄ“ng, zÃ i yÇ” hÃ²u nÃ­ngjÃ¬ng de mÃ¹sÃ¨ zhÅng, huÃ¬chÃ©ng yÃ­ piÃ n mÄ›imiÃ o de yÄ«nxiÇng.",
        "start": 85.63,
        "end": 98.08
    },
    {
        "text": "æˆ‘å€‘å¾ªç€é˜è²ï¼Œä¾†åˆ°äº†åŠå±±è…°çš„æ…¶é›²å¯ºã€‚",
        "pinyin": "WÇ’men xÃºn zhe zhÅngshÄ“ng, lÃ¡i dÃ o le bÃ nshÄnyÄo de QÃ¬ngyÃºnsÃ¬.",
        "start": 98.08,
        "end": 104.37
    },
    {
        "text": "é€™æ˜¯ä¸€åº§å»ºæ–¼æ˜ä»£ã€è¦æ¨¡å®å¤§çš„å¶ºå—è‘—åå¤å‰ã€‚",
        "pinyin": "ZhÃ¨ shÃ¬ yÃ­ zuÃ² jiÃ n yÃº MÃ­ngdÃ i, guÄ«mÃ³ hÃ³ngdÃ  de LÇngnÃ¡n zhÃ¹mÃ­ng gÇ”chÃ .",
        "start": 104.37,
        "end": 112.15
    },
    {
        "text": "åº­é™¢è£ç¹èŠ±ä¼¼éŒ¦ï¼Œå¤æ¨¹åƒå¤©ã€‚",
        "pinyin": "TÃ­ngyuÃ n lÇ fÃ¡nhuÄ sÃ¬ jÇn, gÇ”shÃ¹ cÄntiÄn.",
        "start": 112.15,
        "end": 117.88
    },
    {
        "text": "æœ‰ä¸€æ ªèˆ‡å¤å‰åŒé½¡çš„èŒ¶èŠ±ï¼Œé‚„æœ‰å…©æ ªå¾æ–¯é‡Œè˜­å¡å¼•ç¨®çš„ã€æœ‰äºŒç™¾å¤šå¹´æ¨¹é½¡çš„è©ææ¨¹ã€‚",
        "pinyin": "YÇ’u yÃ¬ zhÅ« yÇ” gÇ”chÃ  tÃ³nglÃ­ng de chÃ¡huÄ, hÃ¡iyÇ’u liÇng zhÅ« cÃ³ng SÄ«lÇlÃ¡nkÇ yÇnzhÃ²ng de, yÇ’u Ã¨rbÇi duÅ niÃ¡n shÃ¹lÃ­ng de pÃºtÃ­shÃ¹.",
        "start": 117.88,
        "end": 130.43
    },
    {
        "text": "æˆ‘å€‘æ±ºå®šå°±åœ¨é€™åº§å¯ºé™¢è£å€Ÿå®¿ã€‚",
        "pinyin": "WÇ’men juÃ©dÃ¬ng jiÃ¹ zÃ i zhÃ¨ zuÃ² sÃ¬yuÃ n lÇ jiÃ¨sÃ¹.",
        "start": 130.43,
        "end": 135.08
    },
    {
        "text": "å…¥å¤œï¼Œå±±ä¸­è¬ç±Ÿä¿±å¯‚ï¼Œè¡¹æœ‰æ³‰è²ä¸€ç›´å‚³é€åˆ°æ•é‚Šã€‚",
        "pinyin": "RÃ¹yÃ¨, shÄn zhÅng wÃ nlÃ i jÃ¹ jÃ¬, zhÇyÇ’u quÃ¡nshÄ“ng yÃ¬zhÃ­ chuÃ¡nsÃ²ng dÃ o zhÄ›nbiÄn.",
        "start": 135.08,
        "end": 145.5
    },
    {
        "text": "ä¸€è·¯ä¸Šè½åˆ°çš„å„ç¨®æ³‰è²ï¼Œé€™æ™‚å€™èººåœ¨åºŠä¸Šï¼Œå¯ä»¥ç”¨å¿ƒç´°ç´°åœ°è†è½ã€è¾¨è­˜ã€å“å‘³ã€‚",
        "pinyin": "YÃ­ lÃ¹ shang tÄ«ngdÃ o de gÃ¨zhÇ’ng quÃ¡nshÄ“ng, zhÃ¨ shÃ­hou tÇng zÃ i chuÃ¡ngshÃ ng, kÄ›yÇ yÃ²ngxÄ«n xÃ¬xÃ¬ de lÃ­ngtÄ«ng, biÃ nshÃ­, pÇnwÃ¨i.",
        "start": 145.5,
        "end": 158.95
    },
    {
        "text": "é‚£åƒå°æç´ä¸€æ¨£è¼•æŸ”çš„ï¼Œæ˜¯è‰å¢ä¸­æµæ·Œçš„å°æºªçš„è²éŸ³ï¼›",
        "pinyin": "NÃ  xiÃ ng xiÇotÃ­qÃ­n yÃ­yÃ ng qÄ«ngrÃ³u de, shÃ¬ cÇocÃ³ng zhÅng liÃºtÇng de xiÇoxÄ« de shÄ“ngyÄ«n;",
        "start": 158.95,
        "end": 167.15
    },
    {
        "text": "é‚£åƒçµç¶ä¸€æ¨£æ¸…è„†çš„ï¼Œæ˜¯åœ¨çŸ³ç¸«é–“è·Œè½çš„æ¾—æ°´çš„è²éŸ³ï¼›",
        "pinyin": "NÃ  xiÃ ng pÃ­pÃ¡ yÃ­yÃ ng qÄ«ngcuÃ¬ de, shÃ¬ zÃ i shÃ­fÃ¨ng jiÄn diÄ“luÃ² de jiÃ nshuÇ de shÄ“ngyÄ«n;",
        "start": 167.15,
        "end": 174.75
    },
    {
        "text": "é‚£åƒå¤§æç´ä¸€æ¨£åšé‡å›éŸ¿çš„ï¼Œæ˜¯ç„¡æ•¸é“ç´°æµåŒ¯èšæ–¼ç©ºè°·çš„è²éŸ³ï¼›",
        "pinyin": "NÃ  xiÃ ng dÃ tÃ­qÃ­n yÃ­yÃ ng hÃ²uzhÃ²ng huÃ­xiÇng de, shÃ¬ wÃºshÃ¹ dÃ o xÃ¬liÃº huÃ¬jÃ¹ yÃº kÅnggÇ” de shÄ“ngyÄ«n;",
        "start": 174.75,
        "end": 184.4
    },
    {
        "text": "é‚£åƒéŠ…ç®¡é½Šé³´ä¸€æ¨£é›„æ¸¾ç£…ç¤´çš„ï¼Œæ˜¯é£›ç€‘æ€¥æµè·Œå…¥æ·±æ½­çš„è²éŸ³ã€‚",
        "pinyin": "NÃ  xiÃ ng tÃ³ngguÇn qÃ­mÃ­ng yÃ­yÃ ng xiÃ³nghÃºn pÃ¡ngbÃ³ de, shÃ¬ fÄ“ipÃ¹ jÃ­liÃº diÄ“rÃ¹ shÄ“ntÃ¡n de shÄ“ngyÄ«n.",
        "start": 184.4,
        "end": 194.58
    }
]

        // ---------------- è®Šé‡ ----------------
        let currentPlayingIndex = -1;
        let isPlaying = false;
        let audio = document.getElementById('audio-player');
        let completedSentences = new Set();
        let username = "";
        let timer = null;

        // ---------------- åˆå§‹åŒ– ----------------
        window.onload = function() {
            renderContent();
            renderGamification();
        };

        function renderContent() {
            const container = document.getElementById('main-content');
            container.innerHTML = '';
            
            sentenceData.forEach((item, index) => {
                const row = document.createElement('div');
                row.className = 'sentence-row';
                row.id = `row-${index}`;
                
                row.innerHTML = `
                    <div class="pinyin">${item.pinyin}</div>
                    <div class="hanzi">${item.text}</div>
                    <div class="controls">
                        <button class="control-btn" onclick="togglePlay(${index})">
                            <span id="btn-icon-${index}">â–¶</span> æ’­æ”¾
                        </button>
                    </div>
                `;
                container.appendChild(row);
            });
        }

        function renderGamification() {
            const track = document.getElementById('star-track');
            track.innerHTML = '';
            
            // æ˜Ÿæ˜Ÿ
            sentenceData.forEach((_, index) => {
                const star = document.createElement('div');
                star.className = 'star';
                star.id = `star-${index}`;
                star.innerHTML = 'â˜…'; // æˆ–ä½¿ç”¨åœ–ç‰‡/åœ–æ¨™
                track.appendChild(star);
            });

            // çæ¯
            const trophy = document.createElement('div');
            trophy.className = 'trophy';
            trophy.id = 'trophy';
            trophy.innerHTML = 'ğŸ†';
            track.appendChild(trophy);
        }

        // ---------------- ç™»éŒ„é‚è¼¯ ----------------
        function handleEnter(e) {
            if (e.key === 'Enter') checkLogin();
        }

        function checkLogin() {
            const userIn = document.getElementById('username').value.trim();
            const passIn = document.getElementById('password').value;
            const errorMsg = document.getElementById('login-error');

            if (passIn === 'vtcpsc' && userIn !== "") {
                username = userIn;
                document.getElementById('login-overlay').style.display = 'none';
            } else {
                errorMsg.style.display = 'block';
                if(userIn === "") errorMsg.textContent = "è«‹è¼¸å…¥åå­—";
                else errorMsg.textContent = "è«‹è¼¸å…¥æ­£ç¢ºå¯†ç¢¼";
            }
        }

        // ---------------- éŸ³é »é‚è¼¯ ----------------
        function togglePlay(index) {
            if (currentPlayingIndex === index && isPlaying) {
                // æš«åœ
                pauseAudio();
            } else {
                // æ’­æ”¾
                playSentence(index);
            }
        }

        function playSentence(index) {
            // å¦‚æœåˆ‡æ›äº†å¥å­ï¼Œé‡ç½®ä¹‹å‰çš„åœ–æ¨™
            if (currentPlayingIndex !== -1 && currentPlayingIndex !== index) {
                updateIcon(currentPlayingIndex, false);
            }

            currentPlayingIndex = index;
            const data = sentenceData[index];
            
            // å¦‚æœæ˜¯å¾æš«åœè™•ç¹¼çºŒï¼Œä¸”é‚„åœ¨ç¯„åœå…§
            if (!isPlaying || audio.paused) {
                if (audio.currentTime < data.start || audio.currentTime >= data.end) {
                    audio.currentTime = data.start;
                }
                audio.play();
                isPlaying = true;
                updateIcon(index, true);
                
                // å•Ÿå‹•ç›£è½å™¨
                if (timer) clearInterval(timer);
                timer = setInterval(() => checkTime(index), 100);
            }
        }

        function pauseAudio() {
            audio.pause();
            isPlaying = false;
            if (currentPlayingIndex !== -1) {
                updateIcon(currentPlayingIndex, false);
            }
            if (timer) clearInterval(timer);
        }

        function checkTime(index) {
            const data = sentenceData[index];
            if (audio.currentTime >= data.end) {
                audio.pause();
                isPlaying = false;
                updateIcon(index, false);
                clearInterval(timer);
                markCompleted(index);
            }
        }

        function updateIcon(index, playing) {
            const btnIcon = document.getElementById(`btn-icon-${index}`);
            if (btnIcon) btnIcon.textContent = playing ? 'âšâš' : 'â–¶';
        }

        function markCompleted(index) {
            // æ¨™è¨˜å¥å­è¡Œ
            const row = document.getElementById(`row-${index}`);
            row.classList.add('played');
            
            // æ¨™è¨˜æ˜Ÿæ˜Ÿ
            const star = document.getElementById(`star-${index}`);
            star.classList.add('active');

            completedSentences.add(index);
            checkAllCompleted();
        }

        function checkAllCompleted() {
            if (completedSentences.size === sentenceData.length) {
                document.getElementById('trophy').classList.add('active');
                const finishBtn = document.getElementById('finish-btn');
                finishBtn.classList.add('active');
            }
        }

        // ---------------- å®Œæˆ & å½ˆçª— ----------------
        function showCompletion() {
            // è¤‡è£½ä¿¡æ¯
            const today = new Date();
            const dateStr = `${today.getMonth()+1}æœˆ${today.getDate()}æ—¥`;
            const textToCopy = `${username}å·²æ–¼${dateStr}å®Œæˆä½œå“8è™Ÿè·Ÿè®€ç·´ç¿’ï¼`;
            
            navigator.clipboard.writeText(textToCopy).then(() => {
                // é¡¯ç¤ºå½ˆçª—
                document.getElementById('completion-modal').style.display = 'flex';
            });
        }

        function closeModal() {
            document.getElementById('completion-modal').style.display = 'none';
            // é¡¯ç¤ºå›ä¸»ç›®éŒ„æŒ‰éˆ•
            document.getElementById('home-link-container').style.display = 'block';
            // å†æ¬¡æ‰“é–‹å½ˆçª—é¡¯ç¤ºéˆæ¥
            document.getElementById('completion-modal').style.display = 'flex';
            // éš±è—åŸå§‹æç¤ºæ–‡å­—ï¼Œæ”¹ç‚ºåªé¡¯ç¤ºéˆæ¥ï¼Ÿ
            // ç‚ºäº†ç°¡å–®ï¼Œé€™è£¡å°‡å½ˆçª—å…§å®¹æ”¹ä¸€ä¸‹
            document.querySelector('.modal-content h2').style.display = 'none';
            document.querySelector('.modal-content p').style.display = 'none';
        }

        // ---------------- é–‹ç™¼è€…æ¨¡å¼ ----------------
        let devMode = false;
        let recording = false;
        let timestamps = [];

        function toggleDevMode() {
            devMode = !devMode;
            const panel = document.getElementById('dev-panel');
            panel.style.display = devMode ? 'block' : 'none';
            if (devMode) document.body.classList.add('dev-mode');
            else document.body.classList.remove('dev-mode');
        }

        function startRecording() {
            recording = true;
            timestamps = []; // Clear
            currentPlayingIndex = 0; // Reset logic index
            // Start from 0
            timestamps.push(0); 
            audio.currentTime = 0;
            audio.play();
            updateDevStatus();
        }

        function markNext() {
            if (!recording) return;
            const time = audio.currentTime;
            timestamps.push(Number(time.toFixed(2)));
            
            // Visual feedback
            const idx = timestamps.length - 2; // Current index finished
            document.getElementById('current-sentence-idx').innerText = `Marked End of Sentence ${idx}. Next starts at ${time.toFixed(2)}`;
            
            // If all sentences marked
            if (timestamps.length > sentenceData.length) {
                exportJSON();
            }
        }

        function exportJSON() {
            audio.pause();
            recording = false;
            
            // Construct new JSON
            const newJson = sentenceData.map((item, i) => {
                return {
                    ...item,
                    start: timestamps[i],
                    end: timestamps[i+1] || timestamps[i] + 5 // fallback
                };
            });

            const output = document.getElementById('dev-output');
            output.value = JSON.stringify(newJson, null, 4);
            output.select();
            document.execCommand('copy');
            alert('JSON copied to clipboard! Replace the sentenceData variable in the HTML.');
        }

        function updateDevStatus() {
            if (recording) {
                document.getElementById('current-sentence-idx').style.color = 'red';
            }
        }

        // Space key binding for dev mode
        document.addEventListener('keydown', (e) => {
            if (devMode && recording && e.code === 'Space') {
                e.preventDefault();
                markNext();
            }
        });

    </script>
</body>
</html>
